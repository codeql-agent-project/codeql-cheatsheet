<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>CodeQL Cheatsheets</title><meta property="og:title" content="CodeQL Cheatsheets"><link rel=stylesheet href=https://codeql-agent-project.github.io/codeql-cheatsheet/sass/main.min.css><link rel=stylesheet href=https://codeql-agent-project.github.io/codeql-cheatsheet/sass/homepage.min.css><link rel=stylesheet href=https://codeql-agent-project.github.io/codeql-cheatsheet/sass/queries.min.css><link rel=stylesheet href=https://codeql-agent-project.github.io/codeql-cheatsheet/sass/cheatsheet-detail.min.css><link rel=stylesheet href=https://codeql-agent-project.github.io/codeql-cheatsheet/sass/search.min.css><link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Prompt:wght@700&display=swap" rel=stylesheet><link rel=stylesheet href=https://unpkg.com/leaflet@1.7.1/dist/leaflet.css integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin><link rel=stylesheet href=../../css/prism.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js integrity=sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1 crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=../../js/prism.js></script>
<script src=../../js/lunr.js></script>
<script src=https://unpkg.com/leaflet@1.7.1/dist/leaflet.js integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin></script></head><body class=page><header><nav><ul class=top-nav><li class=top-nav__logo><a href=../../>CodeQL Cheatsheets</a></li><div class=top-nav__link-group><li class=top-nav__link><a href=../../>Home</a></li><li class=top-nav__link><a href=../../tags>Tags</a></li><li class=top-nav__link><a href=../../cpp>C++</a></li><li class=top-nav__link><a href=../../csharp>C#</a></li><li class=top-nav__link><a href=../../javascript>Javascript</a></li><li class=top-nav__link><a href=../../java>Java</a><li class=top-nav__link><a href=../../go>Go</a><li class=top-nav__link><a href=../../python>Python</a><li class=top-nav__link><a href=../../ruby>Ruby</a><li class=top-nav__link><a href=../../about>About</a><li class=top-nav__link><a href=../../search><img class=icons src=../../white-search-icon.ico></a></li></div></ul></nav></header><main class=main-content><div class=container><div class=page-content><div class=cheatsheet-detail-body><h1>IDOR through request to backend service</h1><div class=tag-group><div class=tag><span class=tag-text><a href=../../tags/pattern>pattern</a></span></div><div class=tag><span class=tag-text><a href=../../tags/javascript>javascript</a></span></div><div class=tag><span class=tag-text><a href=../../tags/expert>expert</a></span></div></div><a href=https://lgtm.com/query/lang:javascript/><h4>Author: LGTM</h4></a><pre><code class=language-sql>import javascript
import DataFlow
import DataFlow::PathGraph

/**
 * A taint-tracking configuration that tracks user-controlled values into a &#39;userId&#39; property sent to a backend service.
 */
class IdorTaint extends TaintTracking::Configuration {
  IdorTaint() { this = &#34;IdorTaint&#34; }

  override predicate isSource(Node node) { node instanceof RemoteFlowSource }

  override predicate isSink(Node node) { exists(ClientRequest req | node = req.getADataNode()) }

  override predicate isAdditionalTaintStep(Node pred, Node succ) {
    // Step from x -&gt; { userId: x }
    succ.(SourceNode).getAPropertyWrite(&#34;userId&#34;).getRhs() = pred
  }

  override predicate isSanitizerGuard(TaintTracking::SanitizerGuardNode node) {
    // After a check like `if (userId === session.user.id)`, the userId is considered safe.
    node instanceof EqualityGuard
  }
}

/**
 * A sanitizer for values that have successfully been compared to another value.
 */
class EqualityGuard extends TaintTracking::SanitizerGuardNode, ValueNode {
  override EqualityTest astNode;

  override predicate sanitizes(boolean outcome, Expr e) {
    e = astNode.getAnOperand() and
    outcome = astNode.getPolarity()
  }
}

from IdorTaint cfg, PathNode source, PathNode sink
where cfg.hasFlowPath(source, sink)
select sink.getNode(), source, sink, &#34;Unauthenticated user ID from $@.&#34;, source.getNode(), &#34;here&#34;</code></pre><h4>Description</h4><p>Finds cases where the 'userId' field in a request to another service is an arbitrary user-controlled value, indicating lack of authentication.</p></div></div></div></main><footer><div class=container><div class=footer-content><div class=footer-content__left-group><h2 class=footer-content__site-name>CodeQL Cheatsheets, QL For Everyone</h2><p>Learn Hugo with CloudCannon, 2023</p></div><div class=footer-content__right-group><div class=newsletter-form><h4 class=newsletter-form__form-title>Sign up for our newsletter</h4><div class=input-wrapper><input type=text placeholder="Enter your email">
<a><img class=submit-arrow src=../../arrow-white.svg></a></div></div></div></div><div class=footer-social><a href=# class=icons><img src=../../facebook-icon.svg></a>
<a href=# class=icons><img src=../../linkedin-icon.svg></a>
<a href=# class=icons><img src=../../twitter-icon.svg></a>
<a href=# class=icons><img src=../../youtube-icon.svg></a></div></div><script src=../../js/lunr.js></script>
<script src=../../js/search.js></script></footer></body></html>